<div _ngcontent-ng-c1326421061="" mjfillcontainer=""><div id="crm-explorer-root___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous">
  <style>
    #crm-explorer-root___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      color: #222;
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 0;
      margin: 0;
      width: 100%;
      box-sizing: border-box;
      min-width: 320px;
      max-width: 100vw;
      display: flex;
      flex-direction: column;
      height: 600px;
      max-height: 90vh;
      overflow: hidden;
    }
    #crm-explorer-root___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba * { box-sizing: border-box; }
    #crm-explorer-header___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      padding: 18px 20px 10px 20px;
      border-bottom: 1px solid #e2e8f0;
      background: #f8fafc;
      border-radius: 8px 8px 0 0;
      font-size: 1.4rem;
      font-weight: 600;
      color: #2d3748;
      text-align: center;
      letter-spacing: 0.01em;
    }
    #crm-explorer-main___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      display: flex;
      flex: 1 1 0;
      min-height: 0;
      height: 100%;
      width: 100%;
      background: #fff;
      overflow: hidden;
    }
    #crm-explorer-nav___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      flex: 0 0 210px;
      max-width: 240px;
      min-width: 140px;
      border-right: 1px solid #e2e8f0;
      background: #f8fafc;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }
    #crm-explorer-nav-list___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      list-style: none;
      margin: 0;
      padding: 0;
      flex: 1 1 0;
      overflow-y: auto;
    }
    .crm-explorer-nav-item___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 13px 22px;
      cursor: pointer;
      border-bottom: 1px solid #f1f5f9;
      background: #f8fafc;
      font-size: 1.08rem;
      color: #2d3748;
      transition: background 0.15s, color 0.15s;
      outline: none;
      font-weight: 500;
    }
    .crm-explorer-nav-item___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba.selected {
      background: #4299e1;
      color: #fff;
      font-weight: 600;
    }
    .crm-explorer-nav-item___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba:hover:not(.selected) {
      background: #e2e8f0;
      color: #2b6cb0;
    }
    #crm-explorer-content___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      flex: 1 1 0;
      min-width: 0;
      height: 100%;
      display: flex;
      flex-direction: column;
      background: #fff;
      overflow: hidden;
      position: relative;
    }
    .crm-explorer-list-toolbar___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px 6px 18px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }
    .crm-explorer-list-toolbar___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba input {
      flex: 1 1 0;
      padding: 7px 10px;
      border: 1px solid #cbd5e0;
      border-radius: 4px;
      font-size: 15px;
      background: #fff;
    }
    .crm-explorer-list-toolbar___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba .fa-sort {
      margin-left: 3px;
      font-size: 0.95em;
      color: #a0aec0;
    }
    .crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      width: 100%;
      border-collapse: collapse;
      font-size: 1rem;
      background: #fff;
    }
    .crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba th, .crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba td {
      padding: 10px 12px;
      border-bottom: 1px solid #f1f5f9;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 180px;
    }
    .crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba th {
      background: #f8fafc;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    .crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba tr.selected {
      background: #e3f2fd;
    }
    .crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba tr:hover:not(.selected) {
      background: #f1f5f9;
    }
    .crm-explorer-list-panel___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      flex: 1 1 0;
      min-height: 0;
      overflow-y: auto;
      background: #fff;
      padding-bottom: 10px;
    }
    .crm-explorer-detail-panel___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      flex: 1 1 0;
      min-height: 0;
      overflow-y: auto;
      background: #fff;
      padding: 0 0 10px 0;
      display: flex;
      flex-direction: column;
      animation: fadeIn 0.25s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: none; }
    }
    .crm-explorer-detail-header___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 18px 24px 10px 24px;
      border-bottom: 1px solid #e2e8f0;
      background: #f8fafc;
      font-size: 1.25rem;
      font-weight: 600;
      color: #2d3748;
    }
    .crm-explorer-detail-close___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      margin-left: auto;
      background: none;
      border: none;
      color: #a0aec0;
      font-size: 1.2rem;
      cursor: pointer;
      transition: color 0.15s;
    }
    .crm-explorer-detail-close___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba:hover {
      color: #e53e3e;
    }
    .crm-explorer-tabs___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      display: flex;
      border-bottom: 1px solid #e2e8f0;
      background: #f8fafc;
      padding: 0 24px;
      gap: 0;
    }
    .crm-explorer-tab___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      padding: 12px 22px 10px 22px;
      cursor: pointer;
      font-size: 1.05rem;
      color: #4a5568;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      font-weight: 500;
      transition: color 0.15s, border-bottom 0.15s;
    }
    .crm-explorer-tab___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba.selected {
      color: #2b6cb0;
      border-bottom: 2.5px solid #4299e1;
      font-weight: 600;
      background: #fff;
    }
    .crm-explorer-tab-panel___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      padding: 18px 24px 0 24px;
      flex: 1 1 0;
      min-height: 0;
      overflow-y: auto;
      background: #fff;
    }
    .crm-explorer-detail-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 18px;
      font-size: 1.01rem;
    }
    .crm-explorer-detail-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba th, .crm-explorer-detail-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba td {
      padding: 7px 10px;
      border-bottom: 1px solid #f1f5f9;
      text-align: left;
      vertical-align: top;
    }
    .crm-explorer-detail-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba th {
      color: #718096;
      font-weight: 500;
      width: 160px;
      background: #f8fafc;
    }
    .crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      color: #3182ce;
      text-decoration: underline;
      cursor: pointer;
      font-weight: 500;
      transition: color 0.15s;
    }
    .crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba:hover {
      color: #2b6cb0;
      text-decoration: underline;
    }
    .crm-explorer-open-btn___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
      background: none;
      border: none;
      color: #3182ce;
      font-size: 1.1rem;
      cursor: pointer;
      margin-left: 8px;
      transition: color 0.15s;
    }
    .crm-explorer-open-btn___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba:hover {
      color: #2b6cb0;
    }
    @media (max-width: 900px) {
      #crm-explorer-root___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
        height: 90vh;
      }
      #crm-explorer-main___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
        flex-direction: column;
      }
      #crm-explorer-nav___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba {
        flex: none;
        max-width: 100vw;
        min-width: 0;
        border-right: none;
        border-bottom: 1px solid #e2e8f0;
        height: auto;
      }
    }
  </style>
  <div id="crm-explorer-header___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba">CRM Data Explorer</div>
  <div id="crm-explorer-main___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba">
    <nav id="crm-explorer-nav___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba">
      <ul id="crm-explorer-nav-list___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba"><li class="crm-explorer-nav-item___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba selected" tabindex="0" role="button" aria-label="Accounts"><i class="fa-solid fa-building" style="width:22px;text-align:center;" aria-hidden="true"></i> <span>Accounts</span></li><li class="crm-explorer-nav-item___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" tabindex="0" role="button" aria-label="Contacts"><i class="fa-solid fa-user" style="width:22px;text-align:center;" aria-hidden="true"></i> <span>Contacts</span></li><li class="crm-explorer-nav-item___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" tabindex="0" role="button" aria-label="Activities"><i class="fa-solid fa-calendar-check" style="width:22px;text-align:center;" aria-hidden="true"></i> <span>Activities</span></li></ul>
    </nav>
    <section id="crm-explorer-content___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba"><div class="crm-explorer-detail-header___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba"><i class="fa-solid fa-building" aria-hidden="true"></i> <span>Account Details</span><button class="crm-explorer-detail-close___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" title="Back to list"><i class="fa-solid fa-xmark" aria-hidden="true"></i></button></div><div class="crm-explorer-tabs___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba"><button class="crm-explorer-tab___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba">Details</button><button class="crm-explorer-tab___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba">Contacts</button><button class="crm-explorer-tab___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba selected">Activities</button></div><div class="crm-explorer-tab-panel___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba"><table class="crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba"><thead><tr><th>ActivityType</th><th>Subject</th><th>StartDate</th><th>Status</th><th>Priority</th><th></th></tr></thead><tbody><tr><td>Site Visit</td><td>Infrastructure Assessment</td><td>2025-04-10T15:00:00.000Z</td><td>Completed</td><td>High</td><td><button class="crm-explorer-open-btn___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" title="Open details"><i class="fa-solid fa-arrow-up-right-from-square" aria-hidden="true"></i></button></td></tr><tr><td>Meeting</td><td>Findings Presentation</td><td>2025-04-15T18:30:00.000Z</td><td>Completed</td><td>High</td><td><button class="crm-explorer-open-btn___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" title="Open details"><i class="fa-solid fa-arrow-up-right-from-square" aria-hidden="true"></i></button></td></tr></tbody></table></div></section>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <script>(function() {
    // --- Data Preparation ---
    let _data = null;
    let _userState = {};
    let _callbacks = null;
    let _entities = [
      { name: 'Accounts', icon: 'fa-building', fields: ['AccountName','Industry','AnnualRevenue','AccountStatus','AccountCreatedAt'] },
      { name: 'Contacts', icon: 'fa-user', fields: ['ContactName','Title','Email','Phone','PreferredContactMethod','ContactCreatedAt','AccountName'] },
      { name: 'Activities', icon: 'fa-calendar-check', fields: ['ActivityType','Subject','StartDate','Status','Priority','ActivityCreatedAt','ContactName','AccountName'] }
    ];
    // Used for navigation and foreign key linking
    function getPrimaryKey(entity, row) {
      if(entity==='Accounts') return { AccountName: row.AccountName };
      if(entity==='Contacts') return { ContactName: row.ContactName, AccountName: row.AccountName };
      if(entity==='Activities') return { ActivityType: row.ActivityType, Subject: row.Subject, StartDate: row.StartDate, ContactName: row.ContactName, AccountName: row.AccountName };
      return {};
    }
    function getEntityRows(entity) {
      if(!_data) return [];
      if(entity==='Accounts') {
        // Unique by AccountName
        const grouped = _.groupBy(_data, 'AccountName');
        return Object.values(grouped).map(rows => rows[0]);
      }
      if(entity==='Contacts') {
        // Unique by ContactName+AccountName
        const grouped = _.groupBy(_data, r => r.ContactName+'|'+r.AccountName);
        return Object.values(grouped).map(rows => rows[0]);
      }
      if(entity==='Activities') {
        // Each row is an activity
        return _data.slice();
      }
      return [];
    }
    function getRelatedRows(entity, row, relatedEntity) {
      if(entity==='Accounts' && relatedEntity==='Contacts') {
        return getEntityRows('Contacts').filter(r => r.AccountName===row.AccountName);
      }
      if(entity==='Accounts' && relatedEntity==='Activities') {
        return getEntityRows('Activities').filter(r => r.AccountName===row.AccountName);
      }
      if(entity==='Contacts' && relatedEntity==='Activities') {
        return getEntityRows('Activities').filter(r => r.ContactName===row.ContactName && r.AccountName===row.AccountName);
      }
      return [];
    }
    // --- State Management ---
    function saveUserState() {
      if(_callbacks && typeof _callbacks.UpdateUserState==='function') {
        _callbacks.UpdateUserState(_.cloneDeep(_userState));
      }
    }
    function setState(partial) {
      _userState = Object.assign({}, _userState, partial);
      saveUserState();
    }
    // --- Navigation ---
    function renderNav(selectedEntity) {
      const navList = document.getElementById('crm-explorer-nav-list___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba');
      navList.innerHTML = '';
      _entities.forEach(ent => {
        const li = document.createElement('li');
        li.className = 'crm-explorer-nav-item___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba' + (selectedEntity===ent.name ? ' selected' : '');
        li.tabIndex = 0;
        li.setAttribute('role','button');
        li.setAttribute('aria-label', ent.name);
        li.innerHTML = `<i class="fa-solid ${ent.icon}" style="width:22px;text-align:center;"></i> <span>${ent.name}</span>`;
        li.onclick = () => {
          setState({ selectedEntity: ent.name, selectedRowKey: null, listFilter: '', listSort: { field: null, dir: null } });
          render();
        };
        li.onkeydown = e => { if(e.key==='Enter' || e.key===' ') { li.onclick(); e.preventDefault(); } };
        navList.appendChild(li);
      });
    }
    // --- List/Grid View ---
    function renderListPanel(entity) {
      const content = document.getElementById('crm-explorer-content___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba');
      content.innerHTML = '';
      // Toolbar
      const toolbar = document.createElement('div');
      toolbar.className = 'crm-explorer-list-toolbar___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
      const filterInput = document.createElement('input');
      filterInput.type = 'text';
      filterInput.placeholder = 'Filter...';
      filterInput.value = _userState.listFilter || '';
      filterInput.oninput = _.debounce(function() {
        setState({ listFilter: filterInput.value });
        render();
      }, 120);
      toolbar.appendChild(filterInput);
      content.appendChild(toolbar);
      // Table
      const tablePanel = document.createElement('div');
      tablePanel.className = 'crm-explorer-list-panel___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
      tablePanel.style.overflowY = 'auto';
      tablePanel.style.maxHeight = 'calc(100% - 44px)';
      const table = document.createElement('table');
      table.className = 'crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
      // Columns
      const fields = _entities.find(e=>e.name===entity).fields;
      const thead = document.createElement('thead');
      const trh = document.createElement('tr');
      fields.forEach(f => {
        const th = document.createElement('th');
        th.textContent = f;
        th.style.cursor = 'pointer';
        const sort = _userState.listSort || {};
        if(sort.field===f) {
          th.innerHTML += ` <i class="fa-solid fa-sort${sort.dir==='asc' ? '-up' : sort.dir==='desc' ? '-down' : ''}"></i>`;
        } else {
          th.innerHTML += ' <i class="fa-solid fa-sort"></i>';
        }
        th.onclick = () => {
          let dir = 'asc';
          if(sort.field===f && sort.dir==='asc') dir = 'desc';
          setState({ listSort: { field: f, dir } });
          render();
        };
        trh.appendChild(th);
      });
      trh.appendChild(document.createElement('th')); // For open button
      thead.appendChild(trh);
      table.appendChild(thead);
      // Rows
      let rows = getEntityRows(entity);
      // Filtering
      const filter = (_userState.listFilter||'').toLowerCase();
      if(filter) {
        rows = rows.filter(r => fields.some(f => (r[f]||'').toString().toLowerCase().includes(filter)));
      }
      // Sorting
      const sort = _userState.listSort || {};
      if(sort.field) {
        rows = _.orderBy(rows, [r => (r[sort.field]||'').toString().toLowerCase()], [sort.dir||'asc']);
      }
      const tbody = document.createElement('tbody');
      rows.forEach((row, idx) => {
        const tr = document.createElement('tr');
        const rowKey = JSON.stringify(getPrimaryKey(entity, row));
        if(_userState.selectedRowKey===rowKey) tr.className = 'selected';
        fields.forEach(f => {
          const td = document.createElement('td');
          let val = row[f];
          if(f==='AccountName' && entity!=='Accounts' && val) {
            td.innerHTML = `<span class="crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" data-link-entity="Accounts" data-link-key="${encodeURIComponent(val)}">${val}</span>`;
          } else if(f==='ContactName' && entity!=='Contacts' && val) {
            td.innerHTML = `<span class="crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" data-link-entity="Contacts" data-link-key="${encodeURIComponent(row.ContactName)}|${encodeURIComponent(row.AccountName)}">${val}</span>`;
          } else {
            td.textContent = val;
          }
          tr.appendChild(td);
        });
        // Open button
        const tdOpen = document.createElement('td');
        const btn = document.createElement('button');
        btn.className = 'crm-explorer-open-btn___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
        btn.title = 'Open details';
        btn.innerHTML = '<i class="fa-solid fa-arrow-up-right-from-square"></i>';
        btn.onclick = e => {
          setState({ selectedRowKey: rowKey });
          render();
          e.stopPropagation();
        };
        tdOpen.appendChild(btn);
        tr.appendChild(tdOpen);
        tr.onclick = () => {
          setState({ selectedRowKey: rowKey });
          render();
        };
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      tablePanel.appendChild(table);
      content.appendChild(tablePanel);
      // Foreign key navigation
      tablePanel.addEventListener('click', function(e) {
        const link = e.target.closest('.crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba');
        if(link) {
          const entity = link.getAttribute('data-link-entity');
          const key = link.getAttribute('data-link-key');
          if(entity==='Accounts') {
            setState({ selectedEntity: 'Accounts', selectedRowKey: JSON.stringify({ AccountName: decodeURIComponent(key) }) });
            render();
          } else if(entity==='Contacts') {
            const [contact, account] = key.split('|').map(decodeURIComponent);
            setState({ selectedEntity: 'Contacts', selectedRowKey: JSON.stringify({ ContactName: contact, AccountName: account }) });
            render();
          }
        }
      });
    }
    // --- Detail View ---
    function renderDetailPanel(entity, row) {
      const content = document.getElementById('crm-explorer-content___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba');
      content.innerHTML = '';
      // Header
      const header = document.createElement('div');
      header.className = 'crm-explorer-detail-header___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
      header.innerHTML = `<i class="fa-solid ${_entities.find(e=>e.name===entity).icon}"></i> <span>${entity.slice(0,-1)} Details</span>`;
      const closeBtn = document.createElement('button');
      closeBtn.className = 'crm-explorer-detail-close___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
      closeBtn.title = 'Back to list';
      closeBtn.innerHTML = '<i class="fa-solid fa-xmark"></i>';
      closeBtn.onclick = () => {
        setState({ selectedRowKey: null });
        render();
      };
      header.appendChild(closeBtn);
      content.appendChild(header);
      // Tabs
      let tabs = [];
      if(entity==='Accounts') tabs = ['Details','Contacts','Activities'];
      else if(entity==='Contacts') tabs = ['Details','Activities'];
      else if(entity==='Activities') tabs = ['Details'];
      const tabStateKey = `tab_${entity}`;
      let selectedTab = _userState[tabStateKey] || tabs[0];
      const tabsDiv = document.createElement('div');
      tabsDiv.className = 'crm-explorer-tabs___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
      tabs.forEach(tab => {
        const t = document.createElement('button');
        t.className = 'crm-explorer-tab___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba' + (selectedTab===tab ? ' selected' : '');
        t.textContent = tab;
        t.onclick = () => {
          setState({ [tabStateKey]: tab });
          render();
        };
        tabsDiv.appendChild(t);
      });
      content.appendChild(tabsDiv);
      // Tab panel
      const tabPanel = document.createElement('div');
      tabPanel.className = 'crm-explorer-tab-panel___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
      if(selectedTab==='Details') {
        // Details table
        const table = document.createElement('table');
        table.className = 'crm-explorer-detail-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
        const tbody = document.createElement('tbody');
        Object.entries(row).forEach(([k,v]) => {
          if(k==='AccountName' && entity!=='Accounts' && v) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<th>${k}</th><td><span class="crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" data-link-entity="Accounts" data-link-key="${encodeURIComponent(v)}">${v}</span></td>`;
            tbody.appendChild(tr);
          } else if(k==='ContactName' && entity!=='Contacts' && v) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<th>${k}</th><td><span class="crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" data-link-entity="Contacts" data-link-key="${encodeURIComponent(row.ContactName)}|${encodeURIComponent(row.AccountName)}">${v}</span></td>`;
            tbody.appendChild(tr);
          } else {
            const tr = document.createElement('tr');
            tr.innerHTML = `<th>${k}</th><td>${v}</td>`;
            tbody.appendChild(tr);
          }
        });
        table.appendChild(tbody);
        tabPanel.appendChild(table);
        // Open in parent
        const openBtn = document.createElement('button');
        openBtn.className = 'crm-explorer-open-btn___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
        openBtn.innerHTML = '<i class="fa-solid fa-arrow-up-right-from-square"></i> Open in parent';
        openBtn.onclick = () => {
          if(_callbacks && typeof _callbacks.OpenEntityRecord==='function') {
            _callbacks.OpenEntityRecord(entity, Object.entries(getPrimaryKey(entity, row)).map(([FieldName,Value])=>({FieldName,Value})));
          } else {
            alert('Open '+entity+' '+JSON.stringify(getPrimaryKey(entity, row)));
          }
        };
        tabPanel.appendChild(openBtn);
      } else if(selectedTab==='Contacts') {
        // List of contacts for this account
        const contacts = getRelatedRows('Accounts', row, 'Contacts');
        if(contacts.length) {
          const table = document.createElement('table');
          table.className = 'crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
          const thead = document.createElement('thead');
          const trh = document.createElement('tr');
          ['ContactName','Title','Email','Phone'].forEach(f => {
            const th = document.createElement('th'); th.textContent = f; trh.appendChild(th);
          });
          trh.appendChild(document.createElement('th'));
          thead.appendChild(trh); table.appendChild(thead);
          const tbody = document.createElement('tbody');
          contacts.forEach(c => {
            const tr = document.createElement('tr');
            ['ContactName','Title','Email','Phone'].forEach(f => {
              const td = document.createElement('td');
              if(f==='ContactName') {
                td.innerHTML = `<span class="crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba" data-link-entity="Contacts" data-link-key="${encodeURIComponent(c.ContactName)}|${encodeURIComponent(c.AccountName)}">${c.ContactName}</span>`;
              } else {
                td.textContent = c[f];
              }
              tr.appendChild(td);
            });
            // Open btn
            const tdOpen = document.createElement('td');
            const btn = document.createElement('button');
            btn.className = 'crm-explorer-open-btn___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
            btn.title = 'Open details';
            btn.innerHTML = '<i class="fa-solid fa-arrow-up-right-from-square"></i>';
            btn.onclick = e => {
              setState({ selectedEntity: 'Contacts', selectedRowKey: JSON.stringify({ ContactName: c.ContactName, AccountName: c.AccountName }) });
              render();
              e.stopPropagation();
            };
            tdOpen.appendChild(btn);
            tr.appendChild(tdOpen);
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);
          tabPanel.appendChild(table);
        } else {
          tabPanel.innerHTML = '<div style="color:#a0aec0;">No contacts for this account.</div>';
        }
      } else if(selectedTab==='Activities') {
        // List of activities for this account/contact
        let activities = [];
        if(entity==='Accounts') activities = getRelatedRows('Accounts', row, 'Activities');
        else if(entity==='Contacts') activities = getRelatedRows('Contacts', row, 'Activities');
        if(activities.length) {
          const table = document.createElement('table');
          table.className = 'crm-explorer-list-table___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
          const thead = document.createElement('thead');
          const trh = document.createElement('tr');
          ['ActivityType','Subject','StartDate','Status','Priority'].forEach(f => {
            const th = document.createElement('th'); th.textContent = f; trh.appendChild(th);
          });
          trh.appendChild(document.createElement('th'));
          thead.appendChild(trh); table.appendChild(thead);
          const tbody = document.createElement('tbody');
          activities.forEach(a => {
            const tr = document.createElement('tr');
            ['ActivityType','Subject','StartDate','Status','Priority'].forEach(f => {
              const td = document.createElement('td');
              td.textContent = a[f];
              tr.appendChild(td);
            });
            // Open btn
            const tdOpen = document.createElement('td');
            const btn = document.createElement('button');
            btn.className = 'crm-explorer-open-btn___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba';
            btn.title = 'Open details';
            btn.innerHTML = '<i class="fa-solid fa-arrow-up-right-from-square"></i>';
            btn.onclick = e => {
              setState({ selectedEntity: 'Activities', selectedRowKey: JSON.stringify(getPrimaryKey('Activities', a)) });
              render();
              e.stopPropagation();
            };
            tdOpen.appendChild(btn);
            tr.appendChild(tdOpen);
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);
          tabPanel.appendChild(table);
        } else {
          tabPanel.innerHTML = '<div style="color:#a0aec0;">No activities found.</div>';
        }
      }
      content.appendChild(tabPanel);
      // Foreign key navigation
      tabPanel.addEventListener('click', function(e) {
        const link = e.target.closest('.crm-explorer-link___SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba');
        if(link) {
          const entity = link.getAttribute('data-link-entity');
          const key = link.getAttribute('data-link-key');
          if(entity==='Accounts') {
            setState({ selectedEntity: 'Accounts', selectedRowKey: JSON.stringify({ AccountName: decodeURIComponent(key) }) });
            render();
          } else if(entity==='Contacts') {
            const [contact, account] = key.split('|').map(decodeURIComponent);
            setState({ selectedEntity: 'Contacts', selectedRowKey: JSON.stringify({ ContactName: contact, AccountName: account }) });
            render();
          }
        }
      });
    }
    // --- Main Render ---
    function render() {
      const entity = _userState.selectedEntity || _entities[0].name;
      renderNav(entity);
      // If detail selected
      if(_userState.selectedRowKey) {
        const rows = getEntityRows(entity);
        const row = rows.find(r => JSON.stringify(getPrimaryKey(entity, r))===_userState.selectedRowKey);
        if(row) {
          renderDetailPanel(entity, row);
          return;
        } else {
          setState({ selectedRowKey: null });
        }
      }
      renderListPanel(entity);
    }
    // --- INIT ---
    function efbInit(data, userState, callbacks) {
      _data = (data && data.data_item_0) ? data.data_item_0 : (window.sampleData ? window.sampleData.data_item_0 : []);
      _callbacks = callbacks || null;
      _userState = userState || {};
      if(!_userState.selectedEntity) _userState.selectedEntity = _entities[0].name;
      render();
    }
    function printFunction() {
      window.print();
    }
    function refreshFunction() {
      if(_callbacks && typeof _callbacks.RefreshData==='function') {
        _callbacks.RefreshData();
      }
    }
    // Expose skipObject       
    const skipObject = {         
      init: efbInit,         
      print: printFunction, // a function you create that is of type SkipHTMLReportPrintFunction         
      refresh: refreshFunction // a function you create that is of type SkipHTMLReportRefreshFunction       
    };       
    window["__SKIPAI_html_report_object_420db47b222a46af9667d482817c2dba"] = skipObject;       
    // Auto-init for demo       
    efbInit(null, null); 
  })();
  </script>
</div></div>